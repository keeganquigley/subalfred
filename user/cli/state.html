<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>state - Subalfred Book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../../../index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../../user/installation.html"><strong aria-hidden="true">1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../../user/cli/index.html"><strong aria-hidden="true">2.</strong> Command</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../user/cli/check.html"><strong aria-hidden="true">2.1.</strong> check</a></li><li class="chapter-item expanded "><a href="../../user/cli/convert.html"><strong aria-hidden="true">2.2.</strong> convert</a></li><li class="chapter-item expanded "><a href="../../user/cli/get.html"><strong aria-hidden="true">2.3.</strong> get</a></li><li class="chapter-item expanded "><a href="../../user/cli/hash.html"><strong aria-hidden="true">2.4.</strong> hash</a></li><li class="chapter-item expanded "><a href="../../user/cli/key.html"><strong aria-hidden="true">2.5.</strong> key</a></li><li class="chapter-item expanded "><a href="../../user/cli/rpc.html"><strong aria-hidden="true">2.6.</strong> rpc</a></li><li class="chapter-item expanded "><a href="../../user/cli/state.html" class="active"><strong aria-hidden="true">2.7.</strong> state</a></li><li class="chapter-item expanded "><a href="../../user/cli/storage-key.html"><strong aria-hidden="true">2.8.</strong> storage-key</a></li><li class="chapter-item expanded "><a href="../../user/cli/workspace.html"><strong aria-hidden="true">2.9.</strong> workspace</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Reference Guide(TODO)</li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Subalfred Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/hack-ink/subalfred/tree/main/doc" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/hack-ink/subalfred/edit/main/doc/src/user/cli/state.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="command-state"><a class="header" href="#command-state">Command <code>state</code></a></h1>
<pre><code>A set of tools to process Substrate-like chain state

Usage: subalfred state [OPTIONS] &lt;COMMAND&gt;

Commands:
  diff
          Check the differences between the two states.
          Note:
          This is not a symmetric difference operation.
          `a.diff(b)` might equal `b.diff(a)`, but not always.
  export
          Export the chain state from the Substrate-like node through the WS RPC endpoint
  fork-off
          Fork-off the Substrate-like chain state
  insert
          Insert the key/value pair into the specific file
  override
          Override the chain spec a with b.
  help
          Print this message or the help of the given subcommand(s)

Options:
  -l, --log &lt;TARGET=LEVEL,*&gt;
          Set a custom log filter.

          This flag is also working with the `RUST_LOG` environment variable. If you use `RUST_LOG` simultaneously, this will append `RUST_LOG`'s value after the log.

          [default: info]

  -h, --help
          Print help information (use `-h` for a summary)
</code></pre>
<h2 id="command-state-diff"><a class="header" href="#command-state-diff">Command <code>state diff</code></a></h2>
<pre><code>Check the differences between the two states.
Note:
This is not a symmetric difference operation.
`a.diff(b)` might equal `b.diff(a)`, but not always.

Usage: subalfred state diff [OPTIONS] &lt;PATH&gt; &lt;PATH&gt;

Arguments:
  &lt;PATH&gt;
          Chain spec a's path

  &lt;PATH&gt;
          Chain spec b's path

Options:
  -l, --log &lt;TARGET=LEVEL,*&gt;
          Set a custom log filter.

          This flag is also working with the `RUST_LOG` environment variable. If you use `RUST_LOG` simultaneously, this will append `RUST_LOG`'s value after the log.

          [default: info]

  -h, --help
          Print help information (use `-h` for a summary)
</code></pre>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code class="language-sh">subalfred state diff chain-spec-a.json chain-spec-b.json
</code></pre>
<pre><code class="language-diff">-0xbd2a529379475088d3e29a918cd47872878d434d6125b40443fe11fd292d13a4:0x03000000
-0x4d45a146e2a002ba470f48b9ed9a3e23878d434d6125b40443fe11fd292d13a4:0x02000200
-0xcebf674407db61a30e8759ec5084b7764e7b9012096b41c4eb3aaf947f6ea429:0x0000
</code></pre>
<pre><code class="language-sh">subalfred state diff chain-spec-b.json chain-spec-a.json
</code></pre>
<pre><code class="language-diff">+0xbd2a529379475088d3e29a918cd47872878d434d6125b40443fe11fd292d13a4:0x03000000
+0x4d45a146e2a002ba470f48b9ed9a3e23878d434d6125b40443fe11fd292d13a4:0x02000200
+0xcebf674407db61a30e8759ec5084b7764e7b9012096b41c4eb3aaf947f6ea429:0x0000
</code></pre>
<h2 id="command-state-export"><a class="header" href="#command-state-export">Command <code>state export</code></a></h2>
<pre><code>Export the chain state from the Substrate-like node through the WS RPC endpoint.

The result will be stored at `&lt;a&gt;.export`.

Usage: subalfred state export [OPTIONS] &lt;URI&gt;

Arguments:
  &lt;URI&gt;
          Live chain's HTTP RPC endpoint

Options:
      --at &lt;HASH/NUM&gt;
          Export the data starting from this block

      --timeout &lt;SECS&gt;
          Timeout for the fetching

          [default: 10]

      --all
          Export all the data.

          So, it conflicts with any other filter option.

          Note:
          The default behaviour (without this option) is fetching according to metadata's pallet
          storage records, which means if there is any old storage prefix that can not be found in
          the current runtime's pallet storage names will be ignored.

      --skip-pallets &lt;[PALLET]&gt;
          Skip these pallets, while fetching.

          It's useful when you want to skip the 'large' pallets.

      --renew-consensus-with &lt;PATH&gt;
          Renew the consensus relate things of the chain.

          We need the dev chain specification to renew the consensus relates genesis. Otherwise, the
          fork-off chain won't produce block.

          It will:
          - Skip `[&quot;System&quot;, &quot;Babe&quot;, &quot;Authorship&quot;, &quot;Session&quot;, &quot;Grandpa&quot;, &quot;Beefy&quot;]` pallets, but keep
            the `System::Account` data. (in order to make the new chain runnable)
          - Change the id and impl name to `*-export`.
          - Clear the bootnodes.
          - Set the `Staking::ForceEra` to `ForceNone`. (in order to prevent the validator set from
            changing mid-test)

          Usually use this as below to get a runnable fork-off chain, and you can do whatever you
          want on it. Test new features, runtime upgrade, etc.

          ```sh
          xxx-node --export-state &gt; xxx-export.json
          xxx-node --build-spec xxx-dev &gt; xxx-dev.json
          subalfred state fork-off xxx-export.json --renew-consensus-with xxx.dev.json --simple-governance --disable-default-bootnodes
          xxx-node --chain xxx.json.fork-off --alice --tmp
          ```

          Note:
          `--alice` only works for which dev chain's genesis validator is `//Alice`, otherwise the
          new chain won't produce block. If your dev chain's genesis validator is `//Bob`, then
          running with `--bob`. But if your dev chain's genesis validator isn't any one of the
          well-known keys, then you should start the node with `--validator` and insert the key
          manually.

      --simple-governance
          Use `//Alice` to control the governance.

          It's useful when you want to test the runtime upgrade.

          It will:
          - Replace sudo key with `//Alice`, if the sudo pallet existed.
          - Replace phragmen election and council members with `//Alice`, if the collective pallet
            existed.
          - Replace technical membership and tech.comm members with `//Alice`, if the membership
            pallet existed.

      --disable-default-bootnodes
          Disable adding the default bootnodes to the specification.

  -l, --log &lt;TARGET=LEVEL,*&gt;
          Set a custom log filter.

          This flag is also working with the `RUST_LOG` environment variable. If you use `RUST_LOG` simultaneously, this will append `RUST_LOG`'s value after the log.

          [default: info]

  -h, --help
          Print help information (use `-h` for a summary)
</code></pre>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<h4 id="env-preparation"><a class="header" href="#env-preparation">ENV preparation</a></h4>
<pre><code class="language-sh">git clone https://github.com/substrate-developer-hub/substrate-node-template.git /tmp/subalfred-example/substrate-node-template
cd /tmp/subalfred-example/substrate-node-template
cargo build
target/debug/node-template build-spec --dev --raw &gt; chain-spec.json
target/debug/node-template --chain chain-spec.json --alice --tmp
</code></pre>
<p>Open <a href="https://polkadot.js.org/apps/?rpc=ws://127.0.0.1:9944#/accounts">PolkadotApps account page</a>.
Check <strong>Dave</strong>'s balances is <strong>0</strong>. Then transfer <strong>10 UNIT</strong> from <strong>Alice</strong> to <strong>Dave</strong>.</p>
<h4 id="start-example"><a class="header" href="#start-example">Start example</a></h4>
<pre><code class="language-sh"># Open a new terminal.
cd /tmp/subalfred-example/substrate-node-template
subalfred state export ws://127.0.0.1:9944 -lsubalfred_core::state,subalfred_core::substrate_client
</code></pre>
<p>The exported state is locate at <code>/tmp/subalfred-example/substrate-node-template/default-chain-spec.json.export</code>.</p>
<h2 id="command-state-fork-off"><a class="header" href="#command-state-fork-off">Command <code>state fork-off</code></a></h2>
<pre><code>Fork-off the Substrate-like chain state.

The result will be stored at `&lt;a&gt;.fork-off`.

Usage: subalfred state fork-off [OPTIONS] &lt;PATH&gt;

Arguments:
  &lt;PATH&gt;
          Target chain spec file's path

Options:
      --renew-consensus-with &lt;PATH&gt;
          Renew the consensus relate things of the chain.

          We need the dev chain specification to renew the consensus relates genesis. Otherwise, the
          fork-off chain won't produce block.

          It will:
          - Skip `[&quot;System&quot;, &quot;Babe&quot;, &quot;Authorship&quot;, &quot;Session&quot;, &quot;Grandpa&quot;, &quot;Beefy&quot;]` pallets, but keep
            the `System::Account` data. (in order to make the new chain runnable)
          - Change the id and impl name to `*-export`.
          - Clear the bootnodes.
          - Set the `Staking::ForceEra` to `ForceNone`. (in order to prevent the validator set from
            changing mid-test)

          Usually use this as below to get a runnable fork-off chain, and you can do whatever you
          want on it. Test new features, runtime upgrade, etc.

          ```sh
          xxx-node --export-state &gt; xxx-export.json
          xxx-node --build-spec xxx-dev &gt; xxx-dev.json
          subalfred state fork-off xxx-export.json --renew-consensus-with xxx.dev.json --simple-governance --disable-default-bootnodes
          xxx-node --chain xxx.json.fork-off --alice --tmp
          ```

          Note:
          `--alice` only works for which dev chain's genesis validator is `//Alice`, otherwise the
          new chain won't produce block. If your dev chain's genesis validator is `//Bob`, then
          running with `--bob`. But if your dev chain's genesis validator isn't any one of the
          well-known keys, then you should start the node with `--validator` and insert the key
          manually.

      --simple-governance
          Use `//Alice` to control the governance.

          It's useful when you want to test the runtime upgrade.

          It will:
          - Replace sudo key with `//Alice`, if the sudo pallet existed.
          - Replace phragmen election and council members with `//Alice`, if the collective pallet
            existed.
          - Replace technical membership and tech.comm members with `//Alice`, if the membership
            pallet existed.

      --disable-default-bootnodes
          Disable adding the default bootnodes to the specification.

  -l, --log &lt;TARGET=LEVEL,*&gt;
          Set a custom log filter.

          This flag is also working with the `RUST_LOG` environment variable. If you use `RUST_LOG` simultaneously, this will append `RUST_LOG`'s value after the log.

          [default: info]

  -h, --help
          Print help information (use `-h` for a summary)
</code></pre>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<h4 id="env-preparation-1"><a class="header" href="#env-preparation-1">ENV preparation</a></h4>
<p>Finish the <a href="#command-state-export">Command <code>state export</code></a>'s example first.</p>
<h4 id="start-example-1"><a class="header" href="#start-example-1">Start example</a></h4>
<pre><code class="language-sh">cd /tmp/subalfred-example/substrate-node-template
subalfred state fork-off default-chain-spec.json.export --renew-consensus-with chain-spec.json
target/debug/node-template --chain default-chain-spec.json.export.fork-off --alice --tmp
</code></pre>
<p>Check block number from the console, it should be started from <strong>0</strong>.
It means this is a new chain.</p>
<p>Open <a href="https://polkadot.js.org/apps/?rpc=ws://127.0.0.1:9944#/accounts">PolkadotApps account page</a>.
Check <strong>Dave</strong>'s balances, it should be <strong>10</strong>.
It means this is a new chain with the exported/fork-off(ed) data.</p>
<h2 id="command-state-override"><a class="header" href="#command-state-override">Command <code>state override</code></a></h2>
<pre><code>Override the chain spec a with b.

The result will be stored at `&lt;a&gt;.override`.

Usage: subalfred state override [OPTIONS] &lt;PATH&gt; &lt;PATH&gt;

Arguments:
  &lt;PATH&gt;
          Chain spec a's path

  &lt;PATH&gt;
          Chain spec b's path

Options:
  -l, --log &lt;TARGET=LEVEL,*&gt;
          Set a custom log filter.

          This flag is also working with the `RUST_LOG` environment variable. If you use `RUST_LOG` simultaneously, this will append `RUST_LOG`'s value after the log.

          [default: info]

  -h, --help
          Print help information (use `-h` for a summary)
</code></pre>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<pre><code class="language-sh">subalfred state override a.json b.json
# You could use `diff` command to check the result, its output should be empty.
subalfred state diff a.json.override b.json
</code></pre>
<h2 id="command-state-insert"><a class="header" href="#command-state-insert">Command <code>state insert</code></a></h2>
<pre><code>Insert the key/value pair into the specific file.

If the key already exists, it will be overwritten.

# Examples ```sh # Calculate the WASM code key. subalfred convert ascii2hex ':code' # &quot;0x3a636f6465&quot; # Override the WASM code. subalfred state insert chain-spec.json --key 0x3a636f6465 --with-file runtime.compact.compressed.wasm ```

Usage: subalfred state insert [OPTIONS] --key &lt;HEX&gt; &lt;--value &lt;HEX&gt;|--with-file &lt;PATH&gt;&gt; &lt;PATH&gt;

Arguments:
  &lt;PATH&gt;
          Target state file's path

Options:
      --key &lt;HEX&gt;
          Storage key

      --value &lt;HEX&gt;
          Storage value

      --with-file &lt;PATH&gt;
          Storage value file

  -l, --log &lt;TARGET=LEVEL,*&gt;
          Set a custom log filter.

          This flag is also working with the `RUST_LOG` environment variable. If you use `RUST_LOG` simultaneously, this will append `RUST_LOG`'s value after the log.

          [default: info]

  -h, --help
          Print help information (use `-h` for a summary)
</code></pre>
<h3 id="example-4"><a class="header" href="#example-4">Example</a></h3>
<pre><code class="language-sh"># Update WASM code of a chain spec file.
subalfred state insert chain-spec.json --key 0x3a636f6465 --with-file runtime.compact.compressed.wasm
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../user/cli/rpc.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../../user/cli/storage-key.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../user/cli/rpc.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../../user/cli/storage-key.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
